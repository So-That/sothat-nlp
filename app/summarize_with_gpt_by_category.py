import openai
import os
from dotenv import load_dotenv

load_dotenv()
openai.api_key = os.getenv("OPENAI_API_KEY")

def summarize_with_gpt_by_category(category_reviews: dict) -> str:
    prompt = (
        "다음은 아이폰 15에 대한 사용자 리뷰입니다. "
        "카테고리는 다음과 같고, 각 항목은 관련된 리뷰 문장 리스트입니다. "
        "카테고리별로 500자로 요약해 주세요. 마지막으로 전체 요약을 1000자로 작성해 주세요. "
        "아래 JSON 형식으로 응답해 주세요:\n\n"
        "카테고리별 리뷰 목록은 다음과 같습니다:\n"
    )

    for category, comments in category_reviews.items():
        prompt += f"\n[{category}]\n" + "\n".join(f"- {c}" for c in comments) + "\n"

    response = openai.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": "당신은 사용자 리뷰를 카테고리별로 요약하는 AI입니다."},
            {"role": "user", "content": prompt}
        ],
        max_tokens=1000,
        temperature=0.7
    )

    return response.choices[0].message.content

if __name__ == "__main__":
    category_reviews = {
        "가격/구성": [
            "아이폰 15는 애플답게 가격대가 꽤 높은 편이지만, 기본 저장 용량이 128GB부터 시작되고, 구성품은 충전 케이블만 들어있어서 아쉽긴 해요. 여전히 어댑터는 별도로 구매해야 하다 보니 전체적인 구매 비용이 꽤 올라가는 느낌입니다. 하지만 장기적으로 봤을 때 OS 업데이트가 오래 지원되니 가치 대비 투자라고 볼 수도 있겠네요.",
            "가격이 전반적으로 고가이긴 하지만, 성능이나 브랜드 가치, 그리고 중고 가격 방어력까지 고려하면 타 브랜드 대비 가격 거품이 덜한 편이에요. 그래도 구형 모델과 비교했을 때 눈에 띄는 변화가 적어 아쉽다는 의견도 많습니다."
        ],
        "디자인/외형": [
            "이번 아이폰 15는 전작과 유사한 디자인을 유지하면서도 파스텔 톤 색상과 새로워진 테두리 질감 덕분에 조금 더 부드럽고 세련된 인상을 줍니다. 특히 매트한 후면 유리는 지문이 잘 묻지 않아 실사용자 입장에서 만족도가 높습니다. 무게도 약간 줄어서 손에 들었을 때 그립감이 훨씬 좋아졌어요.",
            "카메라 범프 부분이 여전히 튀어나와 있어서 케이스 없이 사용할 경우 살짝 불균형한 느낌이 있습니다. 하지만 전체적으로 심플하면서도 고급스러운 느낌은 여전하고, 애플만의 미니멀리즘 디자인 철학이 잘 살아 있습니다."
        ],
        "성능/기능": [
            "A16 바이오닉 칩셋 덕분에 앱 실행 속도나 멀티태스킹 성능은 그야말로 최상급이에요. 게임, 영상 편집, 사진 촬영 등 거의 모든 작업에서 버벅임 없이 부드럽게 실행됩니다. 또한 발열 관리도 이전보다 개선되어 장시간 사용 시에도 손에 열감이 덜 느껴지는 편입니다.",
            "아이폰 15는 이번에 처음으로 USB-C 포트를 도입해서 다양한 기기와 호환성이 높아졌S다는 점이 기능성 면에서 큰 장점입니다. 그러나 일반 모델은 USB 2.0 속도만 지원해서 고속 전송이 필요한 사용자에게는 살짝 아쉬울 수 있어요."
        ],
        "편의성/사용감": [
            "iOS 17이 기본 탑재되어 있어 위젯, 연락처 포스터, 스탠바이 모드 등 새로운 기능들을 바로 활용할 수 있어서 편의성이 훨씬 향상됐습니다. 페이스 ID 인식도 매우 빠르고 정확해서 잠금 해제나 앱 로그인 등도 스트레스 없이 가능해요.",
            "무게 밸런스가 좋아지고 엣지 라인이 손에 걸리지 않아서 장시간 사용해도 손목에 부담이 적어요. 진동이나 햅틱 피드백도 여전히 정교해서, 메시지나 알림을 받을 때 감촉이 매우 쾌적합니다. 버튼 위치도 자연스럽고 조작감이 뛰어납니다."
        ],
        "품질/내구성": [
            "세라믹 실드 전면 유리와 항공우주 등급 알루미늄 프레임이 적용되어 전체적인 내구성이 상당히 뛰어납니다. 외부 충격에도 스크래치나 파손이 적어 안심하고 사용할 수 있어요. 또한 IP68 등급 방수방진 지원 덕분에 생활 방수 걱정도 없습니다.",
            "기기 자체의 마감 퀄리티는 여전히 프리미엄입니다. 버튼의 클릭감, 포트 정렬, 유리 마감 모두 깔끔하게 처리되어 있고, 전반적으로 견고한 느낌이 듭니다. 다만, 여전히 기스나 스크래치에 취약하다는 의견도 있어요."
        ],
    }

    result = summarize_with_gpt_by_category(category_reviews)
    print(result)
